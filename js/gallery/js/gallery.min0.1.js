jQuery.fn.IHGallery=function(a){function j(a){var b=parseInt(a.scrollElParent.css(a.direct))+(a._settings.type=="circle"?a.distanceSum:0);for(i=0;i<a.scrollEl.length;i++){if(b==0)return i;if(b<=0)b+=a.scrollEl.eq(i)["outer"+a.eFunc](true);else b-=a.scrollEl.eq(i)["outer"+a.eFunc](true);if(b==0)return i+1}}function h(a){jQuery(a.numHolder,a.gallery).find(a._settings.thumbTag).unbind("click.thumbs").bind("click.thumbs",function(){if(a.scrollElParent.is(":animated"))a.scrollElParent.stop(true,true);var b=jQuery(a.numHolder,a.gallery).find(a._settings.thumbTag);var c=b.index(this);a.offset=a.scrollElParent.find(a._settings.scrollEl).eq(a._settings.type=="circle"?c+a.scrollEl.length:c).position()[a.direct];f(a);return false})}function g(a){return typeof a===typeof 1&&null!==a&&isFinite(a)}function f(a){var b=a.direct,c={};if(a._t)clearTimeout(a._t);c[a.direct]=-a.offset;a.scrollElParent.stop(true,true).animate(c,{duration:a._settings.duration,easing:a._settings.easing,complete:function(){if(a._settings.type=="circle"){if(a.offset<a.distanceSum){a.offset=a.distanceSum*2-(a.distanceSum-a.offset)}else if(a.offset>=a.distanceSum*2){a.offset=a.distanceSum+(a.offset-a.distanceSum*2)}}a.scrollElParent.css(b,-a.offset);jQuery.fn.IHGallery.numListActive(a);if(jQuery.isFunction(a._settings.onChangeFunc)){a._settings.onChangeFunc.apply(a,a)}d(a)}})}function e(a,b){var c=0;var d=0;while(c<b){d+=a.scrollEl.eq(c)["outer"+eFunc](true);c++}return d}function d(a){if(a.switchTime){a._t=setTimeout(function(){b(a)},a.switchTime)}}function c(a){var b;if(a._settings.step&&a._settings.step==true){if(a._settings.type=="circle"){if(a.active-1<0){a.active=a.scrollEl.length-1;b=a.scrollElParent.find(a._settings.scrollEl).eq(a.active).position()[a.direct]}else{a.active--;b=a.scrollElParent.find(a._settings.scrollEl).eq(a.active).position()[a.direct]+a.distanceSum}}else{if(a.active-1<0)a.active=a._settings.type=="start-end"?0:a.scrollEl.length-1;else a.active--;b=a.scrollEl.eq(a.active).position()[a.direct]}}else{b=a.offset;b-=a.step}if(a._settings.type=="start-end-start"){if(a.offset==0)b=a.distanceSum-a.holder["inner"+a.eFunc]()}if(a._settings.type!="circle"){if(b<0)b=0}a.offset=b;f(a)}function b(a){var b;if(a._settings.step&&a._settings.step==true){if(a._settings.type=="circle"){if(a.active+1<=a.scrollEl.length)a.active++;else a.active=0;b=a.scrollElParent.find(a._settings.scrollEl).eq(a.active).position()[a.direct]+a.distanceSum}else{if(a.active+1<a.scrollEl.length)a.active++;else a.active=a._settings.type=="start-end"?a.scrollEl.length-1:0;b=a.scrollEl.eq(a.active).position()[a.direct]}}else{b=a.offset;b+=a.step}if(a._settings.type=="start-end-start"){if(a.offset==a.distanceSum-a.holder["inner"+a.eFunc]())b=0}if(a._settings.type!="circle"){if(b>a.distanceSum-a.holder["inner"+a.eFunc]())b=a.distanceSum-a.holder["inner"+a.eFunc]()}a.offset=b;f(a)}var a=jQuery.extend({btnPrev:".prev",btnNext:".next",holder:"div",scrollElParent:"ul",scrollEl:"li",numHolder:false,numCreate:false,thumbTag:"a",step:false,type:"circle",onClick:null,onChangeFunc:null,direction:"horisontal",easing:"linear",switchTime:false,duration:1500},a);jQuery.fn.IHGallery.numListCreate=function(a,b){var c="";for(var d=0;d<b.length;d++){c+='<li><a href="#">'+(d+1)+"</a></li>"}jQuery(a).html("<ul>"+c+"</ul>")};jQuery.fn.IHGallery.numListActive=function(a){a.active=j(a);if(a.active>a.scrollEl.length-1)a.active=a.scrollEl.length-1;if(a.numHolder){jQuery(a._settings.thumbTag,a.numHolder).removeClass("active");jQuery(a._settings.thumbTag,a.numHolder).eq(a.active).addClass("active")}};return this.each(function(){var f={},i=0,j=0,k=a.direction=="horisontal"?"width":"height",l=a.direction=="horisontal"?"Width":"Height",m=a.direction=="horisontal"?"left":"top";f={_settings:{},_t:null,gallery:this,distanceSum:0,offset:0,func:k,eFunc:l,direct:m};jQuery.extend(f._settings,a);f.bNext=jQuery(a.btnNext,f.gallery).length?jQuery(a.btnNext,f.gallery):false;f.bPrev=jQuery(a.btnPrev,f.gallery).length?jQuery(a.btnPrev,f.gallery):false;f.holder=jQuery(a.holder,f.gallery);f.scrollElParent=jQuery(a.scrollElParent,f.holder).css("position","relative");if(a.direction=="horisontal")f.scrollElParent.css({width:"32000px"});f.scrollEl=jQuery(a.scrollEl,f.scrollElParent);f.scrollEl.each(function(){f.distanceSum+=jQuery(this)["outer"+l](true)});f.active=f.scrollEl.index(f.scrollEl.filter(".active"));if(f.active==-1)f.active=0;f.scrollEl.removeClass("active");if(a.switchTime)f.switchTime=a.switchTime+a.duration;if(a.step&&a.step!=true){f.step=g(a.step)?a.step:f.holder["inner"+l]()}else if(!a.step)f.step=f.holder["inner"+l]();if(f.holder["inner"+l]()<f.distanceSum){f.bNext.css({display:"block"});f.bPrev.css({display:"block"});if(a.type=="circle"){f.offset=f.distanceSum;f.scrollElParent.append(f.scrollEl.clone(true));f.scrollElParent.prepend(f.scrollEl.clone(true))}}j=e(f.active);f.scrollElParent.css(m,-f.offset+j);if(a.direction=="horisontal")f.scrollElParent.css({width:f.distanceSum*3+j});d(f);if(f.bNext){f.bNext.click(function(){if(!f.scrollElParent.is(":animated")){if(jQuery.isFunction(a.onClick))a.onClick.apply(this,f);b(f)}return false})}if(f.bPrev){f.bPrev.click(function(){if(!f.scrollElParent.is(":animated")){if(jQuery.isFunction(a.onClick))a.onClick.apply(this,f);c(f)}return false})}if(a.numHolder){if(a.numHolder.indexOf(">")==-1||a.numHolder.indexOf("<")==-1){f.numHolder=jQuery(a.numHolder,f.gallery)}else{f.numHolder=jQuery(a.numHolder);jQuery(f.gallery).append(f.numHolder)}setTimeout(function(){jQuery.fn.IHGallery.numListActive(f);h(f)},100)}if(a.numCreate)jQuery.fn.IHGallery.numListCreate(f.numHolder,f.scrollEl)});}