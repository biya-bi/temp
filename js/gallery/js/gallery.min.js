jQuery.fn.IHGallery=function(a){function j(a){var b=parseInt(a.scrollElParent.css(a.direct))+(a._settings.type=="circle"?a.distanceSum:0);for(i=0;i<a.scrollEl.length;i++){if(b==0)return i;if(b<=0)b+=a.scrollEl.eq(i)["outer"+a.eFunc](true);else b-=a.scrollEl.eq(i)["outer"+a.eFunc](true);if(b==0)return i+1}}function h(a){jQuery(a.numHolder,a.gallery).find(a._settings.thumbTag).unbind("click.thumbs").bind("click.thumbs",function(){if(a.scrollElParent.is(":animated"))a.scrollElParent.stop(true,true);var b=jQuery(a.numHolder,a.gallery).find(a._settings.thumbTag);var c=b.index(this);a.offset=a.scrollElParent.find(a._settings.scrollEl).eq(a._settings.type=="circle"?c+a.scrollEl.length:c).position()[a.direct];f(a);return false})}function g(a){return typeof a===typeof 1&&null!==a&&isFinite(a)}function f(a){var b=a.direct,c={};if(a._t)clearTimeout(a._t);c[a.direct]=-a.offset;a.scrollElParent.stop(true,true).animate(c,{duration:a._settings.duration,easing:a._settings.easing,complete:function(){if(a._settings.type=="circle"){if(a.offset<a.distanceSum){a.offset=a.distanceSum*2-(a.distanceSum-a.offset)}else if(a.offset>=a.distanceSum*2){a.offset=a.distanceSum+(a.offset-a.distanceSum*2)}}a.scrollElParent.css(b,-a.offset);jQuery.fn.IHGallery.numListActive(a);if(jQuery.isFunction(a._settings.onChangeFunc)){a._settings.onChangeFunc.apply(a,a)}d(a)}})}function e(a,b){var c=0;var d=0;while(c<b){d+=a.scrollEl.eq(c)["outer"+eFunc](true);c++}return d}function d(a){if(a.switchTime){a._t=setTimeout(function(){b(a)},a.switchTime)}}function c(a){var b;if(a._settings.step&&a._settings.step==true){if(a._settings.type=="circle"){if(a.active-1<0){a.active=a.scrollEl.length-1;b=a.scrollElParent.find(a._settings.scrollEl).eq(a.active).position()[a.direct]}else{a.active--;b=a.scrollElParent.find(a._settings.scrollEl).eq(a.active).position()[a.direct]+a.distanceSum}}else{if(a.active-1<0)a.active=a._settings.type=="start-end"?0:a.scrollEl.length-1;else a.active--;b=a.scrollEl.eq(a.active).position()[a.direct]}}else{b=a.offset;b-=a.step}if(a._settings.type=="start-end-start"){if(a.offset==0)b=a.distanceSum-a.holder["inner"+a.eFunc]()}if(a._settings.type!="circle"){if(b<0)b=0}a.offset=b;f(a)}function b(a){var b;if(a._settings.step&&a._settings.step==true){if(a._settings.type=="circle"){if(a.active+1<=a.scrollEl.length)a.active++;else a.active=0;b=a.scrollElParent.find(a._settings.scrollEl).eq(a.active).position()[a.direct]+a.distanceSum}else{if(a.active+1<a.scrollEl.length)a.active++;else a.active=a._settings.type=="start-end"?a.scrollEl.length-1:0;b=a.scrollEl.eq(a.active).position()[a.direct]}}else{b=a.offset;b+=a.step}if(a._settings.type=="start-end-start"){if(a.offset==a.distanceSum-a.holder["inner"+a.eFunc]())b=0}if(a._settings.type!="circle"){if(b>a.distanceSum-a.holder["inner"+a.eFunc]())b=a.distanceSum-a.holder["inner"+a.eFunc]()}a.offset=b;f(a)}var a=jQuery.extend({btnPrev:".prev",btnNext:".next",holder:"div",scrollElParent:"ul",scrollEl:"li",numHolder:false,numCreate:false,thumbTag:"a",step:false,effect:"scroll",type:"circle",onClick:null,onChangeFunc:null,direction:"horisontal",easing:"linear",switchTime:false,duration:1500},a);jQuery.fn.IHGallery.numListCreate=function(a,b){var c="";for(var d=0;d<b.length;d++){c+='<li><a href="#">'+(d+1)+"</a></li>"}jQuery(a).html("<ul>"+c+"</ul>")};jQuery.fn.IHGallery.numListActive=function(a){a.active=j(a);if(a.active>a.scrollEl.length-1)a.active=a.scrollEl.length-1;if(a.numHolder){jQuery(a._settings.thumbTag,a.numHolder).removeClass("active");jQuery(a._settings.thumbTag,a.numHolder).eq(a.active).addClass("active")}};jQuery.fn.IHGallery.scrollEffect=function(f){if(a.direction=="horisontal")f.scrollElParent.css({width:"32000px"});f.scrollEl.each(function(){f.distanceSum+=jQuery(this)["outer"+f.eFunc](true)});if(a.step&&a.step!=true){f.step=g(a.step)?a.step:f.holder["inner"+f.eFunc]()}else if(!a.step)f.step=f.holder["inner"+f.eFunc]();if(f.holder["inner"+f.eFunc]()<f.distanceSum){f.bNext.css({display:"block"});f.bPrev.css({display:"block"});if(a.type=="circle"){f.offset=f.distanceSum;f.scrollElParent.append(f.scrollEl.clone(true));f.scrollElParent.prepend(f.scrollEl.clone(true))}}offsetStartPosition=e(f.active);f.scrollElParent.css(f.direct,-f.offset+offsetStartPosition);if(a.direction=="horisontal")f.scrollElParent.css({width:3*f.distanceSum+offsetStartPosition});if(f.bNext){f.bNext.click(function(){if(!f.scrollElParent.is(":animated")){if(jQuery.isFunction(a.onClick))a.onClick.apply(this,f);b(f)}return false})}if(f.bPrev){f.bPrev.click(function(){if(!f.scrollElParent.is(":animated")){if(jQuery.isFunction(a.onClick))a.onClick.apply(this,f);c(f)}return false})}if(a.numHolder){if(a.numHolder.indexOf(">")==-1&&a.numHolder.indexOf("<")==-1){f.numHolder=jQuery(a.numHolder,f.gallery)}else{f.numHolder=jQuery(a.numHolder);jQuery(f.gallery).append(f.numHolder)}setTimeout(function(){jQuery.fn.IHGallery.numListActive(f);h(f)},100)}d(f)};jQuery.fn.IHGallery.fadeEffect=function(b){function e(e){if(b._t)clearTimeout(b._t);if(b.scrollEl.is(":animated"))b.scrollEl.stop(true,true);if(e!=b.active){if(a.numHolder)c.removeClass("active").eq(e).addClass("active");b.scrollEl.eq(b.active).removeClass("active").animate({opacity:0},{queue:false,duration:b._settings.duration,easing:b._settings.easing,complete:function(){$(this).css({display:"none"})}});b.scrollEl.eq(e).addClass("active").css({opacity:0,display:"block"}).animate({opacity:1},{queue:false,duration:b._settings.duration,easing:b._settings.easing,complete:function(){$(this).css("opacity","auto");b.active=e;d();if(jQuery.isFunction(a.onChange)){a.onChangeFunc.apply(b,b)}}})}}function d(){if(b.switchTime){b._t=setTimeout(function(){if(b.active<b.scrollEl.length-1)e(b.active+1);else e(0)},b.switchTime)}}var c;b.scrollEl.css({position:"absolute",top:0,left:0,zIndex:1,opacity:0}).eq(b.active).css({zIndex:2,opacity:1}).css("opacity","auto");if(b.holder.height()==0){b.holder.css({height:b.scrollEl.eq(b.active).height(),width:b.scrollEl.eq(b.active).width()})}if(b.scrollEl.length>1){b.bNext.css({display:"block"});b.bPrev.css({display:"block"})}d();if(b.bNext){b.bNext.click(function(){if(!b.scrollElParent.is(":animated")){var a=0;if(b.active<b.scrollEl.length-1)a=b.active+1;else a=0;e(a)}return false})}if(b.bPrev){b.bPrev.click(function(){if(!b.scrollElParent.is(":animated")){var a=0;if(b.active>0)a=b.active-1;else a=b.scrollEl.length-1;e(a)}return false})}if(a.numHolder){if(a.numHolder.indexOf(">")==-1&&a.numHolder.indexOf("<")==-1){b.numHolder=jQuery(a.numHolder,b.gallery)}else{b.numHolder=jQuery(a.numHolder);jQuery(b.gallery).append(b.numHolder)}setTimeout(function(){jQuery.fn.IHGallery.numListActive(b);c=jQuery(b.numHolder,b.gallery).find(b._settings.thumbTag);c.unbind("click.thumbs").bind("click.thumbs",function(){if(b.scrollElParent.is(":animated"))b.scrollElParent.stop(true,true);var a=c.removeClass("active").index($(this).addClass("active"));e(a);return false})},100)}};return this.each(function(){var b={},c=0,d=0,e=a.direction=="horisontal"?"width":"height",f=a.direction=="horisontal"?"Width":"Height",g=a.direction=="horisontal"?"left":"top";b={_settings:{},_t:null,gallery:this,distanceSum:0,offset:0,func:e,eFunc:f,direct:g};jQuery.extend(b._settings,a);b.bNext=jQuery(a.btnNext,b.gallery).length?jQuery(a.btnNext,b.gallery):false;b.bPrev=jQuery(a.btnPrev,b.gallery).length?jQuery(a.btnPrev,b.gallery):false;b.holder=jQuery(a.holder,b.gallery);b.scrollElParent=jQuery(a.scrollElParent,b.holder).css("position","relative");b.scrollEl=jQuery(a.scrollEl,b.scrollElParent);b.active=b.scrollEl.index(b.scrollEl.filter(".active"));if(b.active==-1)b.active=0;b.scrollEl.removeClass("active").eq(b.active).addClass("active");if(a.switchTime)b.switchTime=a.switchTime+a.duration;if(b._settings.effect=="scroll")jQuery.fn.IHGallery.scrollEffect(b);if(b._settings.effect=="fade")jQuery.fn.IHGallery.fadeEffect(b);if(a.numCreate)jQuery.fn.IHGallery.numListCreate(b.numHolder,b.scrollEl)});}